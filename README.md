# DS-3
# Кейс 3 (УЦСБ) Обнаружение атак на завод по очистке воды

<!-- vim-markdown-toc Redcarpet -->

* [Состав команды](#состав-команды)
* [Задача](#задача)
* [Описание датасета](#описание-датасета)
* [Структура репозитория](#структура-репозитория)
* [Выводы](#выводы)

<!-- vim-markdown-toc -->

## Состав команды: 
Панфилов Евгений

Калугин Николай

Галямова Евгения

Клочков Александр

Мархай Ольга

Плюснин Олег

Название команды: Команда №10 От заката до рассвета.



## Задача

https://new.skillfactory.ru/hackaton

##  Описание кейса
Кейс подготовлен Сингапурским университетом c помощью стенда для безопасной очистки воды (Secure Water Treatment, SWaT), которая является уменьшенным вариантом реального завода. Стенд работал 11 дней, из которых 7 дней прошло в нормальном режиме (без атак и сбоев), а в оставшиеся дни проводились атаки двух типов:

Кибератаки через компьютерную сеть стенда. Физические атаки, связанные с выводом из строя компонентов стенда (например, двигатель или насос).

Набор данных включает как состояние оборудования и характеристики очищаемой воды, так и сетевой трафик. Атаки в обучающем наборе данных размечены вручную. С помощью размеченных данных вам нужно научиться определять атаки для тестового набора данных.

Помогите сделать воду чистой и улучшить экологию!

## Описание датасета:
- **FIT-101** - Расходомер; Измеряет приток в резервуар сырой воды.
- **LIT-101** - Датчик уровня; Уровень бака сырой воды.
- **MV-101** - Клапан с электроприводом; Контролирует подачу воды в бак сырой воды.
- **P-101** - Насос; Перекачивает воду из резервуара сырой воды на вторую ступень.
- **P-102 (backup)** - cловарь оборудования, входящего в комплектацию
- **AIT-201** - Анализатор проводимости; Измеряет уровень NaCl.
- **AIT-202** - анализатор pH; Измеряет уровень HCl.
- **AIT-203** - анализатор ОВП; Измеряет уровень NaOCl.
- **FIT-201** - Датчик расхода; Управление дозирующими насосами.
- **MV-201** - Клапан с электроприводом; Контролирует поток воды в бак питательной воды UF.
- **P-201** - дозирующий насос; Дозировочный насос NaCl.
- **P-202 (backup)** - дозирующий насос; Дозировочный насос NaCl.
- **P-203** - дозирующий насос; Дозировочный насос HCl.
- **P-204 (backup)** - дозирующий насос; Дозировочный насос HCl.
- **P-205** - дозирующий насос; Дозировочный насос NaOCl
- **P-206 (backup)** - дозирующий насос; Дозировочный насос NaOCl.
- **DPIT-301** - Передатчик с индикацией перепада давления; Контролирует процесс обратной промывки
- **FIT-301** - Расходомер; Измеряет расход воды на этапе ультрафильтрации
- **LIT-301** - Датчик уровня; Уровень бака питательной воды UF.
- **MV-301** - Клапан с электроприводом; Контролирует процесс УФ-обратной промывки.
- **MV-302** - Клапан с электроприводом; Контролирует воду от процесса ультрафильтрации до установки дехлорирования.
- **MV-303** - Клапан с электроприводом; Управляет сливом УФ-обратной промывки.
- **MV-304** - Клапан с электроприводом; Контролирует слив УФ.
- **P-301 (backup)** - Питающий насос УФ; Перекачивает воду из бака питательной воды UF в RO
бак питательной воды через UF-фильтрацию.
- **P-302** - Питающий насос УФ; Перекачивает воду из бака питательной воды UF в RO
бак питательной воды через UF-фильтрацию.
- **AIT-401** - RO измеритель жесткости воды.
- **AIT-402** - ORP-метр; Управляет дозированием NaHSO3(P203), дозированием NaOCl
(P 205).
- **FIT-401** - датчик расхода; Управляет УФ дехлорированием.
- **LIT-401** - Датчик уровня; Уровень бака питательной воды оборотного потока.
- **P-401 (backup)** - Насос; Перекачивает воду из питательного бака обратного потока в УФ-дехлоратор.
- **P-402** - Насос; Перекачивает воду из питательного бака обратного потока в УФ-дехлоратор.
- **P-403** - Насос бисульфата натрия
- **P-404 (backup)** - Насос бисульфата натрия
- **UV-401** - дехлоратор; Удаляет хлор из воды.
- **AIT-501** - анализатор pH обратного потока; Измеряет уровень HCl.
- **AIT-502** - анализатор ОВП подачи обратного потока; Измеряет уровень NaOCl
- **AIT-503** - Анализатор проводимости подачи обратного потока; Измеряет уровень NaCl.
- **AIT-504** - анализатор проводимости пермеата обратного потока; Измеряет уровень NaCl.
- **FIT-501** - Расходомер; Мембранный расходомер обратного потока.
- **FIT-502** - Расходомер; Расходомер пермеата обратного потока.
- **FIT-503** - Расходомер; RO Отклонить расходомер.
- **FIT-504** - Расходомер; Рециркуляционный расходомер обратного потока.
- **P-501** - Насос; Перекачивает дехлорированную воду в систему обратного потока.
- **P-502 (backup)** - Насос; Перекачивает дехлорированную воду в систему обратного потока.
- **PIT-501** - Датчик давления; Давление подачи обратного потока.
- **PIT-502** - Датчик давления; Давление пермеата обратного потока.
- **PIT-503** - Измеритель давления; Давление сброса обратного потока.
- **FIT-601** - Расходомер; Расходомер обратной промывки UF.
- **P-601** - Насос; Перекачивает воду из бака пермеата обратного осмоса в бак сырой воды
(не используется для сбора данных).
- **P-602** - Насос; Перекачивает воду из бака обратной промывки ультрафильтратом в фильтр ультрафильтрата через очастную мембрану.
- **Normal/Attack** - целевая переменная, признак наличия атаки


## Структура репозитория:

[Хакатон_Jane_last_version.ipynb]() - ноутбук с EDA, логистической регрессией, CatBoost 

## Выводы:
Решение первой задачи - задачи классификации на размеченных данных. 

   Было обучено 5 разных моделей: LogisticRegression, CatBoostClassifier, 
Stacking: LogisticRegression(Logistic Regression, CatBoostClassifier), AutoML и Neural Network.
   Все модели дали высокие показатели качества.

   Самые скромные показатели качества у алгорима LogisticRegression[ноутбук]. Это был MVP.
   Применено hold-out-разбиение данных на тренировочную и тестовую части в соотношении 70/30 с 
равномерным распределением классов и последующая стандартизация данных. В процессе обучения 
проведен подбор лучших гиперпараметров для модели с помощью библиотеки optuna.
   В результате сразу были получены достаточно хорошие метрики: Accuracy = 0.9717, f1 = 0.9842, 
confusion_matrix = [[12861, 3525], [296, 118294]], ROC_AUC = 0.9488.

   Далее был обучен алгоритм CatBoostClassifier[ноутбук], который показал намного более высокое 
качество предсказания.
   Здесь так же было применено hold-out-разбиение данных на тренировочную и тестовую части в 
соотношении 70/30 с равномерным распределением классов и последующая стандартизация данных. 
Алгоритм обучен на 3000 итерациях, смаксимальной глубиной деревьев 6 и темпом обучения 0.01.
   В результате были получены следующие метрики: Accuracy = 0.9985, f1 = 0.9992, 
confusion_matrix = [[16238, 148], [52, 118538]], ROC_AUC = 0.99998. Это является очень хорошим 
результатом и фактически приближает предсказания к 100% точности.

   После стекинга[ноутбук] моделей LogisticRegression и CatBoostClassifier с мета-моделью 
LogisticRegression качество предсказания даже ухудшилось. Были получены следующие метрики: 
Accuracy = 0.9966, f1 = 0.9981, confusion_matrix = [[118513 384], [77 16002]], ROC_AUC = 0.9882.

   Анализ данных с использованием алгоритма AutoML[ноутбук] показал интересные результаты. На 
диаграмме значимости признаков признак FIT101 оказался значительно важнее всех остальных. В 
физическом смысле FIT-101 - Расходомер; Измеряет приток в резервуар сырой воды. Можно сделать вывод, 
что большинство атак было произведено с перекрытием подачи воды.
   Метрики качества данной модели следующие: Accuracy = 0.9996, f1 = 0.9984, 
confusion_matrix = [[21824, 0], [48, 158086]], ROC_AUC = 0.9986. Качество этой модели также очень 
высокое и сравнимо с CatBoostClassifier[ноутбук].

   Обученная нейронная сеть, состоящая из 3-х полносвязных слоёв дала следующие показатели метрик: 
Accuracy = 0.9945, f1 = 0.9774, confusion_matrix = [[13265, 223], [390 98602]], ROC_AUC = 0.9995. 
Это является хорошим показателем её качества, но нелучшим. Данная нейронная сеть предсказывает 99,5 % 
атак на систему.

   Решение второй задачи - задачи кластеризации, обнаружения аномалий на неразмеченных данных.
   
   Согласно разработанной гипотезе сделана кластеризация[ноутбук] на 2 кластера, за которые были 
приняты: нормальное состояние работы системы (Normal) и аномальное - (Attack). Применен алгоритм 
K-Means. На созданные кластеры наложены метки датасета и получены следующие метрики качества: 
Accuracy = , f1 = . На основе этого делаем вывод, что гипотеза оказалась верна и качество предсказания 
атак на неразмеченных данных можно считать хорошим.
